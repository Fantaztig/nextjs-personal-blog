kind: pipeline
name: default

steps:
- name: test
  image: node
  commands:
  - npm install
  - npm test
- name: export
  image: node
  commands:
  - npm install
  - npm run build
  - npm run export
- name: deploy
  image: drillster/drone-rsync
  hosts: [ "ruuk.io" ]
  source: ./out/*
  target: ~/ruuk.io
  recursive: true
  user: root
  delete: true
  secrets: [ rsync_key ]
  when:
    branch: [ master ] ## Only the master branch can be deployed to production
